{% extends 'emails/base_email.html' %}

{% block title %}Payment Required - Order #{{ order_number }}{% endblock %}

{% block content %}
<h2>[PAYMENT] Payment Required to Complete Your Order</h2>

<p>Dear {{ customer_name }},</p>

<p>Thank you for your order! To complete your purchase and begin processing, please make payment for your solar equipment order.</p>

<div class="highlight-box">
    <h3>Payment Details:</h3>
    <p><strong>Order Number:</strong> {{ order_number }}</p>
    <p><strong>Total Amount:</strong> KES {{ total_amount|floatformat:2|add:","|cut:" " }}</p>
    <p><strong>Payment Method:</strong> {{ order.get_payment_method_display }}</p>
</div>

<div class="status-box" style="background-color: #fff3cd; border: 1px solid #ffeaa7; padding: 15px; border-radius: 5px; margin: 20px 0;">
    <h4 style="color: #856404; margin: 0 0 15px 0;">[QUICK] Quick Payment Options</h4>
    {% if order.payment_method == 'mpesa' %}
    <p style="margin: 0; color: #856404;">
        <strong>M-Pesa Payment:</strong><br>
        1. Go to M-Pesa menu<br>
        2. Select "Pay Bill"<br>
        3. Enter Business Number: <strong>174379</strong><br>
        4. Account Number: <strong>{{ order_number }}</strong><br>
        5. Amount: <strong>{{ total_amount|floatformat:2 }}</strong><br>
        6. Enter your M-Pesa PIN and confirm
    </p>
    {% else %}
    <p style="margin: 0; color: #856404;">
        Please contact our sales team at {{ company_phone }} or {{ company_email }} to arrange payment.
    </p>
    {% endif %}
</div>

<h3>Items in Your Order:</h3>
<table style="width: 100%; border-collapse: collapse; margin: 20px 0;">
    <thead>
        <tr style="background-color: #f8f9fa;">
            <th style="padding: 10px; text-align: left; border: 1px solid #ddd;">Product</th>
            <th style="padding: 10px; text-align: center; border: 1px solid #ddd;">Qty</th>
            <th style="padding: 10px; text-align: right; border: 1px solid #ddd;">Unit Price</th>
            <th style="padding: 10px; text-align: right; border: 1px solid #ddd;">Total</th>
        </tr>
    </thead>
    <tbody>
        {% for item in items %}
        <tr>
            <td style="padding: 10px; border: 1px solid #ddd;">{{ item.product_name }}</td>
            <td style="padding: 10px; text-align: center; border: 1px solid #ddd;">{{ item.quantity }}</td>
            <td style="padding: 10px; text-align: right; border: 1px solid #ddd;">KES {{ item.unit_price|floatformat:2|add:","|cut:" " }}</td>
            <td style="padding: 10px; text-align: right; border: 1px solid #ddd;">KES {{ item.total_price|floatformat:2|add:","|cut:" " }}</td>
        </tr>
        {% endfor %}
        <tr style="background-color: #f8f9fa; font-weight: bold;">
            <td colspan="3" style="padding: 10px; border: 1px solid #ddd; text-align: right;">Total Amount:</td>
            <td style="padding: 10px; text-align: right; border: 1px solid #ddd;">KES {{ total_amount|floatformat:2|add:","|cut:" " }}</td>
        </tr>
    </tbody>
</table>

<div class="cta-box">
    <p><strong>Questions about payment?</strong></p>
    <a href="tel:{{ company_phone }}" class="btn-primary">Call {{ company_phone }}</a>
    <a href="mailto:{{ company_email }}" class="btn-secondary">Email {{ company_email }}</a>
</div>

<p>Once payment is received, we'll immediately begin processing your order. Thank you for choosing Olivian Group!</p>

{% endblock %}
