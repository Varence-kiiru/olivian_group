{% extends 'emails/base_email.html' %}

{% block title %}Receipt #{{ receipt.receipt_number }}{% endblock %}

{% block content %}
<h2>Payment Receipt</h2>

<p>Dear {{ customer_name }},</p>

<p>Thank you for your payment! We've successfully received your payment and generated your official receipt.</p>

<div class="highlight-box">
    <h3>Receipt Summary:</h3>
    <p><strong>Receipt Number:</strong> {{ receipt.receipt_number }}</p>
    <p><strong>Order Number:</strong> {{ order.order_number }}</p>
    <p><strong>Payment Date:</strong> {{ receipt.issued_date|date:"F d, Y at H:i" }}</p>
    <p><strong>Amount Paid:</strong> KES {{ order.total_amount|floatformat:2|add:","|cut:" " }}</p>
    <p><strong>Payment Method:</strong> {{ order.get_payment_method_display }}</p>
    {% if order.mpesa_transaction_id %}
    <p><strong>M-Pesa Transaction ID:</strong> {{ order.mpesa_transaction_id }}</p>
    {% endif %}
</div>

<h3>Items Purchased:</h3>
<table style="width: 100%; border-collapse: collapse; margin: 20px 0;">
    <thead>
        <tr style="background-color: {{ primary_color }}; color: white;">
            <th style="padding: 12px; text-align: left; border: 1px solid #ddd;">Product</th>
            <th style="padding: 12px; text-align: center; border: 1px solid #ddd;">Qty</th>
            <th style="padding: 12px; text-align: right; border: 1px solid #ddd;">Unit Price</th>
            <th style="padding: 12px; text-align: right; border: 1px solid #ddd;">Total</th>
        </tr>
    </thead>
    <tbody>
        {% for item in order.items.all %}
        <tr>
            <td style="padding: 10px; border: 1px solid #ddd;">{{ item.product_name }}</td>
            <td style="padding: 10px; text-align: center; border: 1px solid #ddd;">{{ item.quantity }}</td>
            <td style="padding: 10px; text-align: right; border: 1px solid #ddd;">KES {{ item.unit_price|floatformat:2|add:","|cut:" " }}</td>
            <td style="padding: 10px; text-align: right; border: 1px solid #ddd;">KES {{ item.total_price|floatformat:2|add:","|cut:" " }}</td>
        </tr>
        {% endfor %}
        <tr style="background-color: #f8f9fa;">
            <td colspan="3" style="padding: 10px; border: 1px solid #ddd; text-align: right; font-weight: bold;">Subtotal:</td>
            <td style="padding: 10px; text-align: right; border: 1px solid #ddd; font-weight: bold;">KES {{ order.subtotal|floatformat:2|add:","|cut:" " }}</td>
        </tr>
        {% if order.discount_amount > 0 %}
        <tr>
            <td colspan="3" style="padding: 10px; border: 1px solid #ddd; text-align: right;">Discount:</td>
            <td style="padding: 10px; text-align: right; border: 1px solid #ddd;">-KES {{ order.discount_amount|floatformat:2|add:","|cut:" " }}</td>
        </tr>
        {% endif %}
        <tr>
            <td colspan="3" style="padding: 10px; border: 1px solid #ddd; text-align: right;">VAT (16%):</td>
            <td style="padding: 10px; text-align: right; border: 1px solid #ddd;">KES {{ order.tax_amount|floatformat:2|add:","|cut:" " }}</td>
        </tr>
        <tr style="background-color: {{ primary_color }}; color: white; font-weight: bold; font-size: 16px;">
            <td colspan="3" style="padding: 15px; border: 1px solid #ddd; text-align: right;">TOTAL PAID:</td>
            <td style="padding: 15px; text-align: right; border: 1px solid #ddd;">KES {{ order.total_amount|floatformat:2|add:","|cut:" " }}</td>
        </tr>
    </tbody>
</table>

<div style="text-align: center; margin: 30px 0;">
    <a href="{{ company_website }}/receipts/{{ receipt.id }}/download/" class="button">Download PDF Receipt</a>
</div>

<div class="highlight-box">
    <h3>Important Information:</h3>
    <ul>
        <li>This receipt serves as proof of payment for your purchase</li>
        <li>Please keep this receipt for your records and warranty claims</li>
        <li>A PDF copy has been attached to this email for your convenience</li>
        <li>For any queries regarding this transaction, please quote the receipt number</li>
    </ul>
</div>

<h3>Next Steps:</h3>
{% if order.order_type == 'product_only' %}
<ol>
    <li>Your order is being prepared for dispatch</li>
    <li>You'll receive a shipping confirmation once items are dispatched</li>
    <li>Track your delivery using the tracking number provided</li>
    <li>Our team will contact you for any clarifications needed</li>
</ol>
{% else %}
<ol>
    <li>Our project team will contact you to schedule installation</li>
    <li>A site survey will be conducted before installation</li>
    <li>Installation will be completed by our certified technicians</li>
    <li>System commissioning and handover will follow completion</li>
</ol>
{% endif %}

<div class="highlight-box">
    <h3>Warranty & Support:</h3>
    <p>All products come with manufacturer warranties. Installation work is covered by our 2-year workmanship warranty. For support, contact us at {{ company_email }} or {{ company_phone }}.</p>
</div>

<p>Thank you for choosing {{ company_name }}! We appreciate your business and look forward to serving you again.</p>

<p>Best regards,<br>
<strong>The Olivian Group Team</strong><br>
Accounts Department</p>

<hr style="margin: 30px 0; border: none; border-top: 1px solid #eee;">

<p style="font-size: 12px; color: #666;">
    <strong>For Support:</strong><br>
    Email: {{ "info@olivian.co.ke" }}<br>
    Phone: {{ company_phone }}<br>
    Business Hours: Monday - Friday, 8:00 AM - 6:00 PM
</p>
{% endblock %}
