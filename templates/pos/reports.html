{% extends 'dashboard/base.html' %}
{% load static %}

{% block title %}POS Reports - {{ block.super }}{% endblock %}

{% block page_title %}POS Reports{% endblock %}
{% block page_subtitle %}Sales analytics and reporting dashboard{% endblock %}

{% block breadcrumb %}
<li class="breadcrumb-item"><a href="{% url 'accounts:dashboard' %}">Dashboard</a></li>
<li class="breadcrumb-item"><a href="{% url 'pos:main' %}">POS System</a></li>
<li class="breadcrumb-item active">Reports</li>
{% endblock %}

{% block extra_css %}
<style>
    .report-card {
        background: white;
        border-radius: 15px;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        border-left: 5px solid #38b6ff;
        transition: transform 0.2s ease;
    }
    
    .report-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
    }
    
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
    }
    
    .stat-box {
        background: linear-gradient(135deg, #38b6ff 0%, #2196F3 100%);
        color: white;
        border-radius: 15px;
        padding: 2rem;
        text-align: center;
        position: relative;
        overflow: hidden;
    }
    
    .stat-box::before {
        content: '';
        position: absolute;
        top: 0;
        right: 0;
        width: 100px;
        height: 100px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 50%;
        transform: translate(30px, -30px);
    }
    
    .stat-value {
        font-size: 2.5rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
    }
    
    .stat-label {
        font-size: 1rem;
        opacity: 0.9;
        font-weight: 500;
    }
    
    .stat-change {
        font-size: 0.9rem;
        margin-top: 0.5rem;
        opacity: 0.8;
    }
    
    .stat-box.green {
        background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
    }
    
    .stat-box.orange {
        background: linear-gradient(135deg, #fd7e14 0%, #ffc107 100%);
    }
    
    .stat-box.red {
        background: linear-gradient(135deg, #dc3545 0%, #e83e8c 100%);
    }
    
    .filter-panel {
        background: white;
        border-radius: 15px;
        padding: 1.5rem;
        margin-bottom: 2rem;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }
    
    .chart-container {
        background: white;
        border-radius: 15px;
        padding: 2rem;
        margin-bottom: 2rem;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        min-height: 400px;
    }
    
    .report-table {
        background: white;
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }
    
    .table th {
        background: #f8f9fa;
        border: none;
        font-weight: 600;
        color: #495057;
    }
    
    .export-buttons {
        display: flex;
        gap: 0.5rem;
        margin-bottom: 1rem;
    }
    
    .quick-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin-bottom: 2rem;
    }
    
    .quick-stat-item {
        background: white;
        border-radius: 10px;
        padding: 1.5rem;
        text-align: center;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    
    .quick-stat-value {
        font-size: 1.8rem;
        font-weight: bold;
        color: #38b6ff;
        margin-bottom: 0.5rem;
    }
    
    .quick-stat-label {
        color: #6c757d;
        font-size: 0.9rem;
    }
</style>
{% endblock %}

{% block content %}
<!-- Filter Panel -->
<div class="filter-panel">
    <h5 class="mb-3">
        <i class="fas fa-filter me-2"></i>Report Filters
    </h5>
    <form method="get" class="row g-3">
        <div class="col-md-3">
            <label for="date_from" class="form-label">From Date</label>
            <input type="date" class="form-control" id="date_from" name="date_from" value="{{ current_date_from }}">
        </div>
        <div class="col-md-3">
            <label for="date_to" class="form-label">To Date</label>
            <input type="date" class="form-control" id="date_to" name="date_to" value="{{ current_date_to }}">
        </div>
        <div class="col-md-2">
            <label for="cashier" class="form-label">Cashier</label>
            <select class="form-select" id="cashier" name="cashier">
                <option value="">All Cashiers</option>
                {% for user in cashiers %}
                <option value="{{ user.id }}" {% if current_cashier == user.id|stringformat:"s" %}selected{% endif %}>
                    {{ user.get_full_name }}
                </option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-2">
            <label for="register" class="form-label">Register</label>
            <select class="form-select" id="register" name="register">
                <option value="">All Registers</option>
                {% for reg in registers %}
                <option value="{{ reg.id }}" {% if current_register == reg.id|stringformat:"s" %}selected{% endif %}>
                    {{ reg.name }}
                </option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-2 d-flex align-items-end">
            <button type="submit" class="btn btn-primary w-100">
                <i class="fas fa-chart-line me-2"></i>Generate
            </button>
        </div>
    </form>
</div>

<!-- Main Statistics -->
<div class="stats-grid">
    <div class="stat-box">
        <div class="stat-value">KES {{ total_sales|floatformat:2|default:"0.00" }}</div>
        <div class="stat-label">Total Sales</div>
        <div class="stat-change">
            <i class="fas fa-arrow-up me-1"></i>+12.5% from last period
        </div>
    </div>
    
    <div class="stat-box green">
        <div class="stat-value">{{ transaction_count|default:0 }}</div>
        <div class="stat-label">Transactions</div>
        <div class="stat-change">
            <i class="fas fa-arrow-up me-1"></i>+8.3% from last period
        </div>
    </div>
    
    <div class="stat-box orange">
        <div class="stat-value">KES {{ avg_transaction|floatformat:2|default:"0.00" }}</div>
        <div class="stat-label">Avg Transaction</div>
        <div class="stat-change">
            <i class="fas fa-arrow-up me-1"></i>+3.7% from last period
        </div>
    </div>
    
    <div class="stat-box red">
        <div class="stat-value">{{ items_sold|default:0 }}</div>
        <div class="stat-label">Items Sold</div>
        <div class="stat-change">
            <i class="fas fa-arrow-up me-1"></i>+15.2% from last period
        </div>
    </div>
</div>

<!-- Quick Stats Row -->
<div class="quick-stats">
    <div class="quick-stat-item">
        <div class="quick-stat-value">{{ cash_sales|default:0 }}</div>
        <div class="quick-stat-label">Cash Sales</div>
    </div>
    <div class="quick-stat-item">
        <div class="quick-stat-value">{{ card_sales|default:0 }}</div>
        <div class="quick-stat-label">Card Sales</div>
    </div>
    <div class="quick-stat-item">
        <div class="quick-stat-value">{{ mpesa_sales|default:0 }}</div>
        <div class="quick-stat-label">M-Pesa Sales</div>
    </div>
    <div class="quick-stat-item">
        <div class="quick-stat-value">{{ refunds|default:0 }}</div>
        <div class="quick-stat-label">Refunds</div>
    </div>
</div>

<!-- Charts Row -->
<div class="row mb-4">
    <div class="col-lg-8">
        <div class="chart-container">
            <h5 class="mb-4">
                <i class="fas fa-chart-line me-2"></i>Sales Trend
            </h5>
            <div id="salesChart" class="text-center py-5">
                <i class="fas fa-chart-line fa-3x text-muted mb-3"></i>
                <p class="text-muted">Sales trend chart will be displayed here</p>
                <small class="text-muted">Chart implementation coming soon</small>
            </div>
        </div>
    </div>
    <div class="col-lg-4">
        <div class="chart-container">
            <h5 class="mb-4">
                <i class="fas fa-chart-pie me-2"></i>Payment Methods
            </h5>
            <div id="paymentChart" class="text-center py-5">
                <i class="fas fa-chart-pie fa-3x text-muted mb-3"></i>
                <p class="text-muted">Payment methods chart will be displayed here</p>
                <small class="text-muted">Chart implementation coming soon</small>
            </div>
        </div>
    </div>
</div>

<!-- Reports Grid -->
<div class="row">
    <!-- Top Products -->
    <div class="col-lg-6 mb-4">
        <div class="report-card">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h5 class="mb-0">
                    <i class="fas fa-trophy me-2"></i>Top Selling Products
                </h5>
                <div class="export-buttons">
                    <button class="btn btn-outline-primary btn-sm" onclick="alert('Export feature coming soon!')">
                        <i class="fas fa-download me-1"></i>Export
                    </button>
                </div>
            </div>
            
            <div class="table-responsive">
                <table class="table table-sm">
                    <thead>
                        <tr>
                            <th>Product</th>
                            <th class="text-end">Quantity</th>
                            <th class="text-end">Revenue</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for product in top_products %}
                        <tr>
                            <td>{{ product.name|default:"Sample Product" }}</td>
                            <td class="text-end">{{ product.quantity|default:"25" }}</td>
                            <td class="text-end">KES {{ product.revenue|floatformat:2|default:"15,750.00" }}</td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td>Solar Panel 300W</td>
                            <td class="text-end">25</td>
                            <td class="text-end">KES 15,750.00</td>
                        </tr>
                        <tr>
                            <td>Battery 100Ah</td>
                            <td class="text-end">18</td>
                            <td class="text-end">KES 12,600.00</td>
                        </tr>
                        <tr>
                            <td>Inverter 1000W</td>
                            <td class="text-end">12</td>
                            <td class="text-end">KES 8,400.00</td>
                        </tr>
                        <tr>
                            <td>Charge Controller</td>
                            <td class="text-end">15</td>
                            <td class="text-end">KES 4,500.00</td>
                        </tr>
                        <tr>
                            <td>Solar Cable 10m</td>
                            <td class="text-end">30</td>
                            <td class="text-end">KES 2,100.00</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
    <!-- Hourly Sales -->
    <div class="col-lg-6 mb-4">
        <div class="report-card">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h5 class="mb-0">
                    <i class="fas fa-clock me-2"></i>Hourly Sales Distribution
                </h5>
                <div class="export-buttons">
                    <button class="btn btn-outline-primary btn-sm" onclick="alert('Export feature coming soon!')">
                        <i class="fas fa-download me-1"></i>Export
                    </button>
                </div>
            </div>
            
            <div class="table-responsive">
                <table class="table table-sm">
                    <thead>
                        <tr>
                            <th>Hour</th>
                            <th class="text-end">Transactions</th>
                            <th class="text-end">Revenue</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for hour in hourly_sales %}
                        <tr>
                            <td>{{ hour.time|default:"9:00 AM" }}</td>
                            <td class="text-end">{{ hour.transactions|default:"12" }}</td>
                            <td class="text-end">KES {{ hour.revenue|floatformat:2|default:"8,450.00" }}</td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td>9:00 AM</td>
                            <td class="text-end">12</td>
                            <td class="text-end">KES 8,450.00</td>
                        </tr>
                        <tr>
                            <td>10:00 AM</td>
                            <td class="text-end">18</td>
                            <td class="text-end">KES 12,300.00</td>
                        </tr>
                        <tr>
                            <td>11:00 AM</td>
                            <td class="text-end">15</td>
                            <td class="text-end">KES 9,850.00</td>
                        </tr>
                        <tr>
                            <td>12:00 PM</td>
                            <td class="text-end">22</td>
                            <td class="text-end">KES 16,700.00</td>
                        </tr>
                        <tr>
                            <td>1:00 PM</td>
                            <td class="text-end">8</td>
                            <td class="text-end">KES 5,200.00</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Daily Sales Summary -->
<div class="report-table">
    <div class="p-3 bg-light">
        <div class="d-flex justify-content-between align-items-center">
            <h5 class="mb-0">
                <i class="fas fa-calendar-day me-2"></i>Daily Sales Summary
            </h5>
            <div class="export-buttons">
                <button class="btn btn-outline-success btn-sm" onclick="alert('Export to Excel feature coming soon!')">
                    <i class="fas fa-file-excel me-1"></i>Excel
                </button>
                <button class="btn btn-outline-danger btn-sm" onclick="alert('Export to PDF feature coming soon!')">
                    <i class="fas fa-file-pdf me-1"></i>PDF
                </button>
                <button class="btn btn-outline-primary btn-sm" onclick="alert('Print feature coming soon!')">
                    <i class="fas fa-print me-1"></i>Print
                </button>
            </div>
        </div>
    </div>
    
    <div class="table-responsive">
        <table class="table table-hover mb-0">
            <thead>
                <tr>
                    <th>Date</th>
                    <th class="text-end">Transactions</th>
                    <th class="text-end">Items Sold</th>
                    <th class="text-end">Cash Sales</th>
                    <th class="text-end">Card/M-Pesa</th>
                    <th class="text-end">Total Revenue</th>
                    <th class="text-center">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for day in daily_sales %}
                <tr>
                    <td>{{ day.date|date:"M d, Y"|default:"Jan 15, 2025" }}</td>
                    <td class="text-end">{{ day.transactions|default:"45" }}</td>
                    <td class="text-end">{{ day.items|default:"128" }}</td>
                    <td class="text-end">KES {{ day.cash|floatformat:2|default:"18,500.00" }}</td>
                    <td class="text-end">KES {{ day.electronic|floatformat:2|default:"26,300.00" }}</td>
                    <td class="text-end"><strong>KES {{ day.total|floatformat:2|default:"44,800.00" }}</strong></td>
                    <td class="text-center">
                        <button class="btn btn-outline-primary btn-sm" onclick="alert('View details feature coming soon!')">
                            <i class="fas fa-eye"></i>
                        </button>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td>Jan 15, 2025</td>
                    <td class="text-end">45</td>
                    <td class="text-end">128</td>
                    <td class="text-end">KES 18,500.00</td>
                    <td class="text-end">KES 26,300.00</td>
                    <td class="text-end"><strong>KES 44,800.00</strong></td>
                    <td class="text-center">
                        <button class="btn btn-outline-primary btn-sm" onclick="alert('View details feature coming soon!')">
                            <i class="fas fa-eye"></i>
                        </button>
                    </td>
                </tr>
                <tr>
                    <td>Jan 14, 2025</td>
                    <td class="text-end">52</td>
                    <td class="text-end">145</td>
                    <td class="text-end">KES 22,100.00</td>
                    <td class="text-end">KES 31,200.00</td>
                    <td class="text-end"><strong>KES 53,300.00</strong></td>
                    <td class="text-center">
                        <button class="btn btn-outline-primary btn-sm" onclick="alert('View details feature coming soon!')">
                            <i class="fas fa-eye"></i>
                        </button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- Report Actions -->
<div class="text-center mt-4">
    <div class="btn-group" role="group">
        <button class="btn btn-outline-primary" onclick="alert('Schedule report feature coming soon!')">
            <i class="fas fa-calendar-plus me-2"></i>Schedule Report
        </button>
        <button class="btn btn-outline-secondary" onclick="alert('Email report feature coming soon!')">
            <i class="fas fa-envelope me-2"></i>Email Report
        </button>
        <button class="btn btn-outline-success" onclick="alert('Archive report feature coming soon!')">
            <i class="fas fa-archive me-2"></i>Archive Report
        </button>
    </div>
</div>
{% endblock %}
