{% extends 'dashboard/base.html' %}
{% load static %}
{% load crispy_forms_tags %}

{% block title %}
    {% if object %}Edit Campaign{% else %}New Campaign{% endif %} - {{ block.super }}
{% endblock %}

{% block page_title %}
    {% if object %}Edit Campaign{% else %}New Campaign{% endif %}
{% endblock %}

{% block page_subtitle %}
    {% if object %}Update campaign details{% else %}Create a new marketing campaign{% endif %}
{% endblock %}

{% block breadcrumb %}
<li class="breadcrumb-item"><a href="{% url 'accounts:dashboard' %}">Dashboard</a></li>
<li class="breadcrumb-item"><a href="{% url 'crm:dashboard' %}">CRM</a></li>
<li class="breadcrumb-item"><a href="{% url 'crm:campaign_list' %}">Campaigns</a></li>
<li class="breadcrumb-item active">{% if object %}Edit{% else %}New{% endif %}</li>
{% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-8 mx-auto">
        <div class="card">
            <div class="card-body">
                <form method="post">
                    {% csrf_token %}

                    <!-- Basic Information -->
                    <div class="form-section mb-4">
                        <h5 class="mb-3">Campaign Information</h5>
                        <div class="row">
                            <div class="col-md-12 mb-3">
                                {{ form.name|as_crispy_field }}
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                {{ form.campaign_type|as_crispy_field }}
                            </div>
                            <div class="col-md-6 mb-3">
                                {{ form.status|as_crispy_field }}
                            </div>
                        </div>
                    </div>

                    <!-- Timing and Budget -->
                    <div class="form-section mb-4">
                        <h5 class="mb-3">Schedule & Budget</h5>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                {{ form.start_date|as_crispy_field }}
                            </div>
                            <div class="col-md-6 mb-3">
                                {{ form.end_date|as_crispy_field }}
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                {{ form.budget|as_crispy_field }}
                            </div>
                            <div class="col-md-6 mb-3">
                                {{ form.target_leads|as_crispy_field }}
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-12 mb-3">
                                {{ form.target_revenue|as_crispy_field }}
                            </div>
                        </div>
                    </div>

                    <!-- Campaign Details -->
                    <div class="form-section mb-4">
                        <h5 class="mb-3">Campaign Details</h5>
                        {{ form.description|as_crispy_field }}
                        {{ form.message|as_crispy_field }}

                        <div class="row">
                            <div class="col-md-12 mb-3">
                                {{ form.landing_page_url|as_crispy_field }}
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-12 mb-3">
                                {{ form.owner|as_crispy_field }}
                            </div>
                        </div>
                    </div>

                    <!-- Form Actions -->
                    <div class="d-flex justify-content-between">
                        <a href="{% url 'crm:campaign_list' %}" class="btn btn-outline-secondary">
                            <i class="fas fa-arrow-left me-2"></i>Cancel
                        </a>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save me-2"></i>
                            {% if object %}Update Campaign{% else %}Create Campaign{% endif %}
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Date validation
    const startDate = document.getElementById('id_start_date');
    const endDate = document.getElementById('id_end_date');
    
    if (startDate && endDate) {
        endDate.addEventListener('change', function() {
            if (startDate.value && this.value) {
                if (new Date(this.value) < new Date(startDate.value)) {
                    alert('End date cannot be before start date');
                    this.value = '';
                }
            }
        });

        startDate.addEventListener('change', function() {
            if (endDate.value && this.value) {
                if (new Date(endDate.value) < new Date(this.value)) {
                    alert('Start date cannot be after end date');
                    this.value = '';
                }
            }
        });
    }

    // Budget validation
    const budget = document.getElementById('id_budget');
    if (budget) {
        budget.addEventListener('input', function() {
            if (this.value < 0) {
                this.value = 0;
            }
        });
    }
});
</script>
{% endblock %}